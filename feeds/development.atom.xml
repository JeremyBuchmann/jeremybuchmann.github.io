<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><title>Jeremy Buchmann - development</title><link href="https://jeremybuchmann.github.io/" rel="alternate"></link><link href="https://jeremybuchmann.github.io/feeds/development.atom.xml" rel="self"></link><id>https://jeremybuchmann.github.io/</id><updated>2016-03-16T21:43:00+01:00</updated><entry><title>How to get PHP to authenticate with AD using LDAPS</title><link href="https://jeremybuchmann.github.io/how-to-get-php-to-authenticate-with-ad-using-ldaps.html" rel="alternate"></link><published>2016-03-16T21:43:00+01:00</published><updated>2016-03-16T21:43:00+01:00</updated><author><name>Jeremy Buchmann</name></author><id>tag:jeremybuchmann.github.io,2016-03-16:/how-to-get-php-to-authenticate-with-ad-using-ldaps.html</id><summary type="html">&lt;p&gt;If you use Active Directory for authentication and also want to
authenticate to it from &lt;span class="caps"&gt;PHP&lt;/span&gt; code, there are a few hoops to jump through,
especially if you want to use &lt;span class="caps"&gt;LDAPS&lt;/span&gt; (&lt;span class="caps"&gt;LDAP&lt;/span&gt; over &lt;span class="caps"&gt;SSL&lt;/span&gt;/&lt;span class="caps"&gt;TLS&lt;/span&gt;). The clients
accomplish this from &lt;span class="caps"&gt;PHP&lt;/span&gt; using the php-ldap library which uses the
OpenLDAP …&lt;/p&gt;</summary><content type="html">&lt;p&gt;If you use Active Directory for authentication and also want to
authenticate to it from &lt;span class="caps"&gt;PHP&lt;/span&gt; code, there are a few hoops to jump through,
especially if you want to use &lt;span class="caps"&gt;LDAPS&lt;/span&gt; (&lt;span class="caps"&gt;LDAP&lt;/span&gt; over &lt;span class="caps"&gt;SSL&lt;/span&gt;/&lt;span class="caps"&gt;TLS&lt;/span&gt;). The clients
accomplish this from &lt;span class="caps"&gt;PHP&lt;/span&gt; using the php-ldap library which uses the
OpenLDAP library which in turn uses the OpenSSL library. I bring this up
because you’ll have to read some documentation from both OpenLDAP and
OpenSSL to understand what’s going&amp;nbsp;on.&lt;/p&gt;
&lt;p&gt;When a client program tries to bind to the &lt;span class="caps"&gt;AD&lt;/span&gt; server, OpenSSL will try
to verify the server’s &lt;span class="caps"&gt;SSL&lt;/span&gt; certificate. &lt;span class="caps"&gt;SSL&lt;/span&gt; certificates are issued by a
Certificate Authority (&lt;span class="caps"&gt;CA&lt;/span&gt;) which have their own certificates to verify
their identities. However, if you have self-signed the certificate for
your &lt;span class="caps"&gt;AD&lt;/span&gt; server, the &lt;span class="caps"&gt;CA&lt;/span&gt; cert is essentially phony. This prevents OpenSSL
from verifying the connection which prevents OpenLDAP from connecting to
the &lt;span class="caps"&gt;AD&lt;/span&gt;&amp;nbsp;server.&lt;/p&gt;
&lt;p&gt;There are two ways around&amp;nbsp;this.&lt;/p&gt;
&lt;p&gt;One way is to tell OpenLDAP to not perform a check on the server’s
certificate. To do this, you &lt;em&gt;could&lt;/em&gt; add this directive to
&lt;code&gt;/etc/openldap/ldap.conf&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;TLS_REQCERT never # Don’t actually do this!
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;But as the &lt;a href="http://www.openldap.org/doc/admin24/tls.html#Client%20Configuration"&gt;OpenLDAP manual
states&lt;/a&gt;,
“for clients the default value is &lt;code&gt;demand&lt;/code&gt; and there generally is no
good reason to change this setting”. So let’s not do&amp;nbsp;that.&lt;/p&gt;
&lt;p&gt;Instead, we can provide the client with a copy of the server’s &lt;span class="caps"&gt;CA&lt;/span&gt;
certificate. Normally, this would come from Verisign or Thawte or
whoever you’d buy a server cert from, but since we’ve self-signed a cert
for the server, we’ve also created a cert for the &lt;span class="caps"&gt;CA&lt;/span&gt;&amp;#8230;which is&amp;nbsp;us.&lt;/p&gt;
&lt;p&gt;By providing this &lt;span class="caps"&gt;CA&lt;/span&gt; cert to the client, the client will believe that
the self-signed certificate is valid, which is what we&amp;nbsp;want.&lt;/p&gt;
&lt;p&gt;The &lt;span class="caps"&gt;CA&lt;/span&gt; cert is a &lt;span class="caps"&gt;PEM&lt;/span&gt; file. Depending on your Linux distribution, the &lt;span class="caps"&gt;CA&lt;/span&gt;
cert file will go into &lt;code&gt;/etc/ssl/certs&lt;/code&gt; (Ubuntu),
&lt;code&gt;/etc/openldap/cacerts&lt;/code&gt; (Red Hat/CentOS 6), or &lt;code&gt;/etc/openldap/certs&lt;/code&gt;
(Red Hat/CentOS 7). The permissions on the &lt;span class="caps"&gt;PEM&lt;/span&gt; files must be be
world-readable (644), or you must create a special group, add the owner
of the process that is accessing the cert to the group, and set the
permission of the cert file to group-readable&amp;nbsp;(640).&lt;/p&gt;
&lt;p&gt;There’s one more step. For whatever reason, OpenSSL expects these files
to be named in the form of &lt;span class="caps"&gt;HHHHHHHH&lt;/span&gt;.D, where each H is a hexadecimal
character and D is a single decimal digit. There’s a script in the
openssl-perl package called &lt;code&gt;c_rehash&lt;/code&gt; that creates symlinks in the
right format for you. For&amp;nbsp;example:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;[root@host]# c_rehash /etc/openldap/certs
Doing /etc/openldap/certs
host-ca.pem =&amp;gt; 4d86282a.0
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Once you have the &lt;span class="caps"&gt;PEM&lt;/span&gt; files and the symlinks in the right place, the &lt;span class="caps"&gt;AD&lt;/span&gt;
authentication in your &lt;span class="caps"&gt;PHP&lt;/span&gt; script should&amp;nbsp;work.&lt;/p&gt;
&lt;p&gt;Note: the c_rehash script is really&amp;nbsp;doing:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;[root@host]# openssl x509 -hash -fingerprint -noout -in file.pem
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;and taking the first line of output to create the hash file&amp;nbsp;name.&lt;/p&gt;</content></entry><entry><title>Five Tools Every Programmer Should Have (that aren’t on a computer)</title><link href="https://jeremybuchmann.github.io/five-tools-every-programmer-should-have-that-arent-on-a-computer.html" rel="alternate"></link><published>2012-06-20T15:35:00+02:00</published><updated>2012-06-20T15:35:00+02:00</updated><author><name>Jeremy Buchmann</name></author><id>tag:jeremybuchmann.github.io,2012-06-20:/five-tools-every-programmer-should-have-that-arent-on-a-computer.html</id><summary type="html">&lt;h3&gt;1. Nail&amp;nbsp;Clippers&lt;/h3&gt;
&lt;p&gt;&lt;img alt="nail clippers" src="https://jeremybuchmann.github.io/images/nail-clippers.jpg"&gt;&lt;/p&gt;
&lt;p&gt;I have a confession to make. I can&amp;#8217;t type. Never learned. Most
programmers I&amp;#8217;ve known couldn&amp;#8217;t type either, which is weird. You&amp;#8217;d think
it&amp;#8217;d be the first thing we learned. Even though the number of symbols in
code makes touch typing a …&lt;/p&gt;</summary><content type="html">&lt;h3&gt;1. Nail&amp;nbsp;Clippers&lt;/h3&gt;
&lt;p&gt;&lt;img alt="nail clippers" src="https://jeremybuchmann.github.io/images/nail-clippers.jpg"&gt;&lt;/p&gt;
&lt;p&gt;I have a confession to make. I can&amp;#8217;t type. Never learned. Most
programmers I&amp;#8217;ve known couldn&amp;#8217;t type either, which is weird. You&amp;#8217;d think
it&amp;#8217;d be the first thing we learned. Even though the number of symbols in
code makes touch typing a little less effective (so I&amp;#8217;ve been told), we
still have to write documentation which is mostly words (you are writing
documentation, right? Good.) Even though I can&amp;#8217;t type, I&amp;#8217;m a pretty fast
hunter-and-pecker. But what really kills my accuracy and speed is when
my fingernails get long enough to get in the way. Keep those babies
trimmed and those fingers&amp;nbsp;flying.&lt;/p&gt;
&lt;h3&gt;2. A Good&amp;nbsp;Chair&lt;/h3&gt;
&lt;p&gt;It goes without saying that you want to be comfortable while you work.
Some people are doing the
&lt;a href="http://lifehacker.com/5830748/why-i-switched-my-office-chair-with-an-exercise-ball-and-what-it-feels-like"&gt;exercise-ball-as-a-chair&lt;/a&gt;
thing while others are going for the &lt;a href="http://lifehacker.com/5735528/why-and-how-i-switched-to-a-standing-desk"&gt;standing
desk&lt;/a&gt;.
But most of us sit in chairs, and chairs vary widely in&amp;nbsp;quality.&lt;/p&gt;
&lt;p&gt;I remember starting a new job some years back and when I was shown to my
desk, the chair was an old, worn out task chair that was missing a bolt
in the backrest which caused the backrest to hang down 90 degrees from
where it was supposed to be. It was the only chair they had for me and
let me tell you, it wasn&amp;#8217;t a pleasant way to spend eight&amp;nbsp;hours.&lt;/p&gt;
&lt;p&gt;&lt;img alt="chair" src="https://jeremybuchmann.github.io/images/chair.jpg"&gt;
This is not the chair you&amp;#8217;re looking&amp;nbsp;for.&lt;/p&gt;
&lt;p&gt;There are a
&lt;a href="http://www.codinghorror.com/blog/2008/07/investing-in-a-quality-programming-chair.html"&gt;ton&lt;/a&gt;
&lt;a href="http://techcrunch.com/2006/12/28/workspace-roundup-ergonomic-chairs/"&gt;of&lt;/a&gt;
&lt;a href="http://ehs.unc.edu/workplace_safety/ergonomics/chairs/"&gt;options&lt;/a&gt; out
there for the new chair buyer, but if you find all of those options
lacking, you could &lt;a href="http://www.arrickrobotics.com/chair/"&gt;make your own computer chair from a luxury car
seat&lt;/a&gt;.&lt;/p&gt;
&lt;h3&gt;3.&amp;nbsp;Coaster&lt;/h3&gt;
&lt;p&gt;Do you have a lot of papers scattered on your desk? And have you ever
set a cold drink down, not realizing you were setting it down on
something you were going to give to someone else? I bet they
didn&amp;#8217;t appreciate the nice wet ring on that report. Easy solution: a
coaster. Aside from allowing you to show off a little
&lt;a href="http://www.thegreenhead.com/2007/11/lego-coaster-set.php"&gt;personality&lt;/a&gt;
or &lt;a href="https://www.cafepress.co.uk/+funny+coasters"&gt;sense of
humor&lt;/a&gt;, it
carves out a little spot on your desk just for that bottle of Diet Mr&amp;nbsp;Pibb.&lt;/p&gt;
&lt;p&gt;&lt;img alt="coaster" src="https://jeremybuchmann.github.io/images/coaster.jpg"&gt;&lt;/p&gt;
&lt;h3&gt;4. Hand&amp;nbsp;Lotion&lt;/h3&gt;
&lt;p&gt;Working in Reno where it&amp;#8217;s not unusual to have single-digit humidity, my
hands dry out to the point that &lt;em&gt;I can&amp;#8217;t stretch my fingers fast enough
to maintain my normal typing speed&lt;/em&gt;. A little hand lotion goes a long
way toward keeping that word count&amp;nbsp;high.&lt;/p&gt;
&lt;p&gt;&lt;img alt="lotion bottle" src="https://jeremybuchmann.github.io/images/lotion.jpg"&gt;&lt;/p&gt;
&lt;h3&gt;5. Printed &lt;span class="caps"&gt;ASCII&lt;/span&gt;&amp;nbsp;Chart&lt;/h3&gt;
&lt;p&gt;I&amp;#8217;ve kept one of these on my wall for as long as I can remember. I just
used it the other day to troubleshoot some incorrectly encoded data we
were trying to import into our database. Good times with my old&amp;nbsp;friend.&lt;/p&gt;
&lt;p&gt;&lt;a href="https://commons.wikimedia.org/wiki/File:ASCII-Table.svg"&gt;&lt;img alt="ASCII chart" src="https://jeremybuchmann.github.io/images/ascii-table.png"&gt;&lt;/a&gt;&lt;/p&gt;
&lt;h3&gt;Bonus:&amp;nbsp;Plants&lt;/h3&gt;
&lt;p&gt;If you&amp;#8217;re the type that likes to work in a &amp;#8220;hacker cave&amp;#8221; (like a
man-cave, but for nerds&amp;#8230;&lt;span class="caps"&gt;BTW&lt;/span&gt;, how great of a show would that be&amp;#8230;are
you listening &lt;span class="caps"&gt;HGTV&lt;/span&gt;?), you may want to look into a little houseplant. Any
old plant will do, but did you know that there are plants that are
especially good at cleaning the air? &lt;a href="http://www.extension.umn.edu/yardandgarden/ygbriefs/h110indoorair.html"&gt;It&amp;#8217;s
true&lt;/a&gt;.&lt;/p&gt;</content></entry><entry><title>Creating Good SQL Aliases</title><link href="https://jeremybuchmann.github.io/creating-good-sql-aliases.html" rel="alternate"></link><published>2012-06-16T21:15:00+02:00</published><updated>2012-06-16T21:15:00+02:00</updated><author><name>Jeremy Buchmann</name></author><id>tag:jeremybuchmann.github.io,2012-06-16:/creating-good-sql-aliases.html</id><summary type="html">&lt;p&gt;I was reviewing someone else&amp;#8217;s code the other day and noticed something
that has been bugging me ever since I learned &lt;span class="caps"&gt;SQL&lt;/span&gt; (a good 10+ years
ago): bad &lt;span class="caps"&gt;SQL&lt;/span&gt; aliases.  Let me start with some non-&lt;span class="caps"&gt;SQL&lt;/span&gt; code as an&amp;nbsp;example.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;int a, b;
string c;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;If you saw …&lt;/p&gt;</summary><content type="html">&lt;p&gt;I was reviewing someone else&amp;#8217;s code the other day and noticed something
that has been bugging me ever since I learned &lt;span class="caps"&gt;SQL&lt;/span&gt; (a good 10+ years
ago): bad &lt;span class="caps"&gt;SQL&lt;/span&gt; aliases.  Let me start with some non-&lt;span class="caps"&gt;SQL&lt;/span&gt; code as an&amp;nbsp;example.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;int a, b;
string c;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;If you saw this in a real-life program, you&amp;#8217;d think that whoever wrote
it was either exceptionally lazy or didn&amp;#8217;t know what they were doing. In
this day and age, you expect good variable names, even if they&amp;#8217;re a bit&amp;nbsp;long.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;int numEmployees, selectedEmployeeId;
string companyName;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Obviously, that&amp;#8217;s much better. So why do I keep seeing &lt;span class="caps"&gt;SQL&lt;/span&gt; queries that
look like&amp;nbsp;this:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;SELECT a.action,
       a.tstamp,
       b.fname,
       b.lname,
       c.fname,
       c.lname,
       d.fname,
       d.lname
FROM personnel_log a
  INNER JOIN users b ON a.target_id = b.id
  INNER JOIN users c ON a.modifier_id = c.id
  INNER JOIN users d ON a.approver_id = d.id
WHERE a.tstamp &amp;gt; &amp;#39;2012-06-16 00:00:00 UTC&amp;#39;::TIMESTAMP WITH TIME ZONE
  AND c.lname ILIKE &amp;#39;%smith%&amp;#39;
  AND b.fname ILIKE &amp;#39;%James%&amp;#39;
ORDER BY d.lname, d.fname, a.tstamp
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;If you&amp;#8217;re trying to figure out the meaning of the expressions in the
&lt;span class="caps"&gt;SELECT&lt;/span&gt; list or the &lt;span class="caps"&gt;WHERE&lt;/span&gt; clauses, you have to keep referring to the &lt;span class="caps"&gt;JOIN&lt;/span&gt;
sections to translate the a, b, c, and d aliases into their actual table
names. In small-ish queries such as this one, it&amp;#8217;s not a huge deal, but
when the queries start getting up to 50 or 100 lines, it becomes a real
chore to track down each letter alias. Now look at the same query with
just a few more&amp;nbsp;keystrokes:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;SELECT plog.action,
       plog.tstamp,
       employee.fname,
       employee.lname,
       modder.fname,
       modder.lname,
       approver.fname,
       approver.lname
FROM personnel_log plog
  INNER JOIN users employee ON plog.target_id = employee.id
  INNER JOIN users modder ON plog.modifier_id = modder.id
  INNER JOIN users approver ON plog.approver_id = approver.id
WHERE plog.tstamp &amp;gt; &amp;#39;2012-06-16 00:00:00 UTC&amp;#39;::TIMESTAMP WITH TIME ZONE
  AND modder.lname ILIKE &amp;#39;%smith%&amp;#39;
  AND employee.fname ILIKE &amp;#39;%James%&amp;#39;
ORDER BY approver.lname, approver.fname, plog.tstamp
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;So much nicer! You know right away that the third &lt;span class="caps"&gt;SELECT&lt;/span&gt; expression is
the employee&amp;#8217;s first name and that the first &lt;span class="caps"&gt;ORDER&lt;/span&gt; clause is the
approver&amp;#8217;s last&amp;nbsp;name.&lt;/p&gt;
&lt;p&gt;An &lt;span class="caps"&gt;SQL&lt;/span&gt; alias is much like a variable name. The better the name, the
easier it is to figure out what the code is trying to&amp;nbsp;do.&lt;/p&gt;</content></entry></feed>